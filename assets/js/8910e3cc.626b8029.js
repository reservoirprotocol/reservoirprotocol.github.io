"use strict";(self.webpackChunkreservoir_docs=self.webpackChunkreservoir_docs||[]).push([[700],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return f}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=c(n),f=a,m=d["".concat(l,".").concat(f)]||d[f]||p[f]||o;return n?r.createElement(m,s(s({ref:t},u),{},{components:n})):r.createElement(m,s({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},254:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return u},default:function(){return d}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),s=["components"],i={sidebar_label:"Buy and Sell",sidebar_position:10},l="Create & Fill Orders (Buy & Sell)",c={unversionedId:"api/use-cases/execute-orders",id:"api/use-cases/execute-orders",title:"Create & Fill Orders (Buy & Sell)",description:"Reservoir gives you access to a fully functional aggregated order book that strives to be a global pool of all NFT liquidity. You can both create orders (list for sale, make an offer) or fill orders (buy token, accept offer).",source:"@site/docs/api/use-cases/execute-orders.md",sourceDirName:"api/use-cases",slug:"/api/use-cases/execute-orders",permalink:"/docs/api/use-cases/execute-orders",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/api/use-cases/execute-orders.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_label:"Buy and Sell",sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"Explore Traits",permalink:"/docs/api/use-cases/explore-traits"},next:{title:"Community Marketplace",permalink:"/docs/api/guides/community-marketplace"}},u=[{value:"Steps",id:"steps",children:[],level:2},{value:"Actions",id:"actions",children:[],level:2}],p={toc:u};function d(e){var t=e.components,n=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"create--fill-orders-buy--sell"},"Create & Fill Orders (Buy & Sell)"),(0,o.kt)("p",null,"Reservoir gives you access to a fully functional aggregated order book that strives to be a global pool of ",(0,o.kt)("em",{parentName:"p"},"all")," NFT liquidity. You can both create orders (list for sale, make an offer) or fill orders (buy token, accept offer)."),(0,o.kt)("p",null,"Importantly, because its a shared order book, tools can specialize on different parts of the market. For example, a market maker could generate bids and feed them directly into the order book, while a wallet could place a sell button next to every NFT in a user's wallet, giving them access to those bids. As more integrations get built, the network effects of the shared order book grow stronger."),(0,o.kt)("h2",{id:"steps"},"Steps"),(0,o.kt)("p",null,"When executing orders, there are often multiple steps, like approving an exchange to access your NFTs, or wrapping WETH for a bid. These steps differ for every different type of liquidity that Reservoir supports. To make this simple, you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"execute")," endpoints, which return the exact steps that you need to follow, including descriptions that you can display to users. "),(0,o.kt)("p",null,"The flow looks like this:"),(0,o.kt)("p",null,"1) Call the ",(0,o.kt)("inlineCode",{parentName:"p"},"execute")," API with the action you want to take (create or fill)",(0,o.kt)("br",{parentName:"p"}),"\n","2) Iterate through the steps, taking the necessary action"),(0,o.kt)("p",null,"There are two types of steps:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"transaction")," > An on-chain transaction that needs to be submitted",(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("inlineCode",{parentName:"p"},"signature")," > A message that needs to be signed"),(0,o.kt)("p",null,"The API returns the exact data that you need to sign/submit, so it can be fed directly into an Ethereum library like Ethers.js. "),(0,o.kt)("p",null,"Any steps that have already been completely (e.g. because the user previously did an approval) are marked as ",(0,o.kt)("inlineCode",{parentName:"p"},"complete")," and can be skipped. Sometimes, the steps are dependent on each other. In these cases, the API will return an empty data field. Once the first step has been completed, request the execute API again in order to get the missing data and continue."),(0,o.kt)("p",null,"We will soon be releasing a hooks library to handle this all automatically, but in the meantime, we recommend looking at how each action is handled in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/reservoirprotocol/sample-marketplace/blob/46c25d3b0f78653f8efe7967d91cb79847f44043/components/BuyNow.tsx"},"sample marketplace"),", and copying from there. Below is an example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// Build parameters\nconst query = {\n    contract,\n    tokenId,\n    side: 'sell',\n    taker: await signer.getAddress(),\n}\nconst url = new URL('/execute/fill', apiBase)\nsetParams(url, query)\n\n// Fetch steps\nconst res = await fetch(url.href)\nconst json = (await res.json()) as Execute\nif (!index) index = 0\nif (json.error) throw new Error(json.error)\nif (!json.steps) throw new ReferenceError('There are no steps.')\n\n// Loop through and execute steps\nif (json.steps.length - 1 >= index) {\n    const { status, kind, data } = json.steps[index]\n    if (status === 'incomplete' && kind === 'transaction') {\n      if (data) {\n        const tx = await signer.sendTransaction(data)\n        await tx.wait()\n      } else {\n        const polledData = (await pollApi(json, url)) as Execute\n        const tx = await signer.sendTransaction(polledData.steps?.[index].data)\n        await tx.wait()\n      }\n    }\n    if (index !== json.steps.length - 1) {\n      await checkCompleteness(url, signer, index + 1)\n    }\n  }\n  return json.steps[json.steps.length - 1]?.data\n")),(0,o.kt)("h2",{id:"actions"},"Actions"),(0,o.kt)("p",null,"The API supports the following actions:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://mainnet-api-v4.reservoir.tools/documentation#/execute/getExecuteBuy"},"Buy")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://mainnet-api-v4.reservoir.tools/documentation#/execute/getExecuteSell"},"Sell")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://mainnet-api-v4.reservoir.tools/documentation#/execute/getExecuteBid"},"Bid")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://mainnet-api-v4.reservoir.tools/documentation#/execute/getExecuteList"},"List"))),(0,o.kt)("p",null,'Note: in order to "buy" a token, you need to fill a corresponding sell order. This can be confusing and we plan to make it clearer in a future version of the API!'))}d.isMDXComponent=!0}}]);