"use strict";(self.webpackChunkreservoir_docs=self.webpackChunkreservoir_docs||[]).push([[700],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return u}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},f=Object.keys(e);for(n=0;n<f.length;n++)a=f[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(n=0;n<f.length;n++)a=f[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),i=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=i(e.components);return n.createElement(c.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,f=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=i(a),u=r,b=p["".concat(c,".").concat(u)]||p[u]||l[u]||f;return a?n.createElement(b,o(o({ref:t},d),{},{components:a})):n.createElement(b,o({ref:t},d))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var f=a.length,o=new Array(f);o[0]=p;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var i=2;i<f;i++)o[i]=a[i];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},254:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return i},toc:function(){return d},default:function(){return p}});var n=a(7462),r=a(3366),f=(a(7294),a(3905)),o=["components"],s={sidebar_label:"Buy and Sell",sidebar_position:10},c="Create & Fill Orders (Buy & Sell)",i={unversionedId:"api/use-cases/execute-orders",id:"api/use-cases/execute-orders",title:"Create & Fill Orders (Buy & Sell)",description:"Reservoir gives you access to a fully functional aggregated order book that strives to be a global pool of all NFT liquidity. You can both create orders (list for sale, make an offer) or fill orders (buy token, accept offer).",source:"@site/docs/api/use-cases/execute-orders.md",sourceDirName:"api/use-cases",slug:"/api/use-cases/execute-orders",permalink:"/docs/api/use-cases/execute-orders",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/api/use-cases/execute-orders.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_label:"Buy and Sell",sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"Explore Traits",permalink:"/docs/api/use-cases/explore-traits"},next:{title:"Community Marketplace",permalink:"/docs/api/guides/community-marketplace"}},d=[{value:"Steps",id:"steps",children:[],level:2},{value:"Supported Actions",id:"supported-actions",children:[],level:2},{value:"Executing Steps",id:"executing-steps",children:[],level:2},{value:"Example API Responses",id:"example-api-responses",children:[],level:2}],l={toc:d};function p(e){var t=e.components,a=(0,r.Z)(e,o);return(0,f.kt)("wrapper",(0,n.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,f.kt)("h1",{id:"create--fill-orders-buy--sell"},"Create & Fill Orders (Buy & Sell)"),(0,f.kt)("p",null,"Reservoir gives you access to a fully functional aggregated order book that strives to be a global pool of ",(0,f.kt)("em",{parentName:"p"},"all")," NFT liquidity. You can both create orders (list for sale, make an offer) or fill orders (buy token, accept offer)."),(0,f.kt)("p",null,"Importantly, because its a shared order book, tools can specialize on different parts of the market. For example, a market maker could generate bids and feed them directly into the order book, while a wallet could place a sell button next to every NFT in a user's wallet, giving them access to those bids. As more integrations get built, the network effects of the shared order book grow stronger."),(0,f.kt)("h2",{id:"steps"},"Steps"),(0,f.kt)("p",null,"When executing orders, there are often multiple steps, like approving an exchange to access your NFTs, or wrapping WETH for a bid. These steps differ for every different type of liquidity that Reservoir supports. To make this simple, you can use the ",(0,f.kt)("inlineCode",{parentName:"p"},"Router")," endpoints, which return the exact steps that you need to follow, including descriptions that you can display to users. "),(0,f.kt)("p",null,"The flow looks like this:"),(0,f.kt)("p",null,"1) Call the ",(0,f.kt)("inlineCode",{parentName:"p"},"Router")," API with the action you want to take (create or fill)",(0,f.kt)("br",{parentName:"p"}),"\n","2) Iterate through the steps, taking the necessary action"),(0,f.kt)("p",null,"There are four types of steps:"),(0,f.kt)("p",null,(0,f.kt)("inlineCode",{parentName:"p"},"transaction")," > An on-chain transaction that needs to be submitted on-chain",(0,f.kt)("br",{parentName:"p"}),"\n",(0,f.kt)("inlineCode",{parentName:"p"},"signature")," > A message that needs to be signed",(0,f.kt)("br",{parentName:"p"}),"\n",(0,f.kt)("inlineCode",{parentName:"p"},"request")," > A request that needs to post data (e.g. to publish an order)",(0,f.kt)("br",{parentName:"p"}),"\n",(0,f.kt)("inlineCode",{parentName:"p"},"confirmation")," > A request that confirms that an action is complete  "),(0,f.kt)("p",null,"The API returns the exact data that you need to sign/submit, so it can be fed directly into an Ethereum library like ethers.js. What's nice about this design pattern is that it is completely generic. As new types of liquidity are added, you can support them automatically without needing to update your app."),(0,f.kt)("h2",{id:"supported-actions"},"Supported Actions"),(0,f.kt)("p",null,"The following actions are possible with the Router API:"),(0,f.kt)("ul",null,(0,f.kt)("li",{parentName:"ul"},(0,f.kt)("a",{parentName:"li",href:"https://api.reservoir.tools/#/3.%20Router/getExecuteBuyV1"},"Buy"),"  "),(0,f.kt)("li",{parentName:"ul"},(0,f.kt)("a",{parentName:"li",href:"https://api.reservoir.tools/#/3.%20Router/getExecuteSellV1"},"Sell"),"  "),(0,f.kt)("li",{parentName:"ul"},(0,f.kt)("a",{parentName:"li",href:"https://api.reservoir.tools/#/3.%20Router/getExecuteBidV1"},"Bid"),"  "),(0,f.kt)("li",{parentName:"ul"},(0,f.kt)("a",{parentName:"li",href:"https://api.reservoir.tools/#/3.%20Router/getExecuteListV1"},"List"),"  "),(0,f.kt)("li",{parentName:"ul"},(0,f.kt)("a",{parentName:"li",href:"https://api.reservoir.tools/#/3.%20Router/getExecuteCancelV1"},"Cancel"),"  ")),(0,f.kt)("h2",{id:"executing-steps"},"Executing Steps"),(0,f.kt)("p",null,"The ",(0,f.kt)("a",{parentName:"p",href:"https://github.com/reservoirprotocol/client-sdk"},"Reservoir Client SDK")," includes helpers that abstract the process of iterating through step, and returning callbacks that can be used to update your UI."),(0,f.kt)("pre",null,(0,f.kt)("code",{parentName:"pre",className:"language-js"},"import { buyToken } from '@reservoir0x/client-sdk'\n\nawait buyToken({\n    token: `${contract}:${tokenId}`,  // Token to purchase\n    signer,                           // Wallet to purchase with\n    apiBase,                          // API Base URL\n    setState: setSteps,               // Callback with progress updates \n    handleSuccess,                    // Callback on success\n    handleError,                      // Callback on error \n})\n")),(0,f.kt)("p",null,"To understand how it works under the hood, check out the ",(0,f.kt)("a",{parentName:"p",href:"https://github.com/reservoirprotocol/client-sdk/blob/main/src/utils/executeSteps.ts"},"executeSteps")," method: "),(0,f.kt)("p",null,"To see it in context, checkout the ",(0,f.kt)("a",{parentName:"p",href:"https://github.com/reservoirprotocol/sample-marketplace/blob/main/components/BuyNow.tsx"},"Sample Marketplace")),(0,f.kt)("h2",{id:"example-api-responses"},"Example API Responses"),(0,f.kt)("pre",null,(0,f.kt)("code",{parentName:"pre",className:"language-js"},'// https://api.reservoir.tools/execute/buy/v1?token=0xca7ca7bcc765f77339be2d648ba53ce9c8a262bd%3A4028&taker=0xD5c0D17cCb9071D27a4F7eD8255F59989b9aee0d\n{\n   "steps":[\n      {\n         "action":"Confirm purchase",\n         "description":"To purchase this item you must confirm the transaction and pay the gas fee",\n         "kind":"transaction",\n         "status":"incomplete",\n         "data":{\n            "from":"0xd5c0d17ccb9071d27a4f7ed8255f59989b9aee0d",\n            "to":"0x7f268357a8c2552623316e2562d90e642bb538e5",\n            "data":"0xab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000d5c0d17ccb9071d27a4f7ed8255f59989b9aee0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000fb0656515e4c4418f070d65696e40888a2f71c4600000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001f400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004702867d72b8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000623d197d00000000000000000000000000000000000000000000000000000000000000006d8d632ef0690ffc05e453a4d31598edc25e512f6dca165e3a9988fe1c574d3000000000000000000000000000000000000000000000000000000000000001f400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004702867d72b8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000623d0d7d00000000000000000000000000000000000000000000000000000000624387cc30eb26e9e84d73a69a32534482f2a62fcfd024b550b5fb5421a095b9e76670e70000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000007c000000000000000000000000000000000000000000000000000000000000008e00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000b400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000046bd837cf1b6599efa93e498ede03d9a4ca6bdd8baf227be4d2caa277190974522dfacc89a227596e22a5b1e3fb1638059ebf584b1baa5bbaaf633ed1891addb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a5950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d5c0d17ccb9071d27a4f7ed8255f59989b9aee0d000000000000000000000000ca7ca7bcc765f77339be2d648ba53ce9c8a262bd0000000000000000000000000000000000000000000000000000000000000fbc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a595000000000000000000000000fb0656515e4c4418f070d65696e40888a2f71c460000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ca7ca7bcc765f77339be2d648ba53ce9c8a262bd0000000000000000000000000000000000000000000000000000000000000fbc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e400000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",\n            "value":"0x04702867d72b8000"\n         }\n      },\n      {\n         "action":"Confirmation",\n         "description":"Verify that the item was successfully purchased",\n         "kind":"confirmation",\n         "status":"incomplete",\n         "data":{\n            "endpoint":"/orders/executed/v1?id=0x65dbad0b32ce4f4014f362620a0bca4b8e997da40a0de2d4d4adfb9684c320c5",\n            "method":"GET"\n         }\n      }\n   ]\n}\n')),(0,f.kt)("pre",null,(0,f.kt)("code",{parentName:"pre",className:"language-js"},'// https://api.reservoir.tools/execute/list/v1?orderbook=reservoir&maker=0xD5c0D17cCb9071D27a4F7eD8255F59989b9aee0d&weiPrice=1000000000000000000000&token=0x0e4b8e24789630618aa90072f520711d3d9db647%3A5356&expirationTime=1648776304\n{\n   "steps":[\n      {\n         "action":"Confirm purchase",\n         "description":"To purchase this item you must confirm the transaction and pay the gas fee",\n         "kind":"transaction",\n         "status":"incomplete",\n         "data":{\n            "from":"0xd5c0d17ccb9071d27a4f7ed8255f59989b9aee0d",\n            "to":"0x7f268357a8c2552623316e2562d90e642bb538e5",\n            "data":"0xab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000d5c0d17ccb9071d27a4f7ed8255f59989b9aee0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000fb0656515e4c4418f070d65696e40888a2f71c4600000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001f400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004702867d72b8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000623d197d00000000000000000000000000000000000000000000000000000000000000006d8d632ef0690ffc05e453a4d31598edc25e512f6dca165e3a9988fe1c574d3000000000000000000000000000000000000000000000000000000000000001f400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004702867d72b8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000623d0d7d00000000000000000000000000000000000000000000000000000000624387cc30eb26e9e84d73a69a32534482f2a62fcfd024b550b5fb5421a095b9e76670e70000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000007c000000000000000000000000000000000000000000000000000000000000008e00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000b400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000046bd837cf1b6599efa93e498ede03d9a4ca6bdd8baf227be4d2caa277190974522dfacc89a227596e22a5b1e3fb1638059ebf584b1baa5bbaaf633ed1891addb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a5950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d5c0d17ccb9071d27a4f7ed8255f59989b9aee0d000000000000000000000000ca7ca7bcc765f77339be2d648ba53ce9c8a262bd0000000000000000000000000000000000000000000000000000000000000fbc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a595000000000000000000000000fb0656515e4c4418f070d65696e40888a2f71c460000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ca7ca7bcc765f77339be2d648ba53ce9c8a262bd0000000000000000000000000000000000000000000000000000000000000fbc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e400000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",\n            "value":"0x04702867d72b8000"\n         }\n      },\n      {\n         "action":"Confirmation",\n         "description":"Verify that the item was successfully purchased",\n         "kind":"confirmation",\n         "status":"incomplete",\n         "data":{\n            "endpoint":"/orders/executed/v1?id=0x65dbad0b32ce4f4014f362620a0bca4b8e997da40a0de2d4d4adfb9684c320c5",\n            "method":"GET"\n         }\n      }\n   ]\n}\n')),(0,f.kt)("p",null,"// Build parameters\nconst query = {\ncontract,\ntokenId,\nside: 'sell',\ntaker: await signer.getAddress(),\n}\nconst url = new URL('/execute/fill', apiBase)\nsetParams(url, query)"),(0,f.kt)("p",null,"// Fetch steps\nconst res = await fetch(url.href)\nconst json = (await res.json()) as Execute\nif (!index) index = 0\nif (json.error) throw new Error(json.error)\nif (!json.steps) throw new ReferenceError('There are no steps.')"),(0,f.kt)("p",null,"// Loop through and execute steps\nif (json.steps.length - 1 >= index) {\nconst { status, kind, data } = json.steps","[index]","\nif (status === 'incomplete' && kind === 'transaction') {\nif (data) {\nconst tx = await signer.sendTransaction(data)\nawait tx.wait()\n} else {\nconst polledData = (await pollApi(json, url)) as Execute\nconst tx = await signer.sendTransaction(polledData.steps?.","[index]",".data)\nawait tx.wait()\n}\n}\nif (index !== json.steps.length - 1) {\nawait checkCompleteness(url, signer, index + 1)\n}\n}\nreturn json.steps","[json.steps.length - 1]","?.data"),(0,f.kt)("pre",null,(0,f.kt)("code",{parentName:"pre"},"\n## Actions\n\nThe API supports the following actions:\n")))}p.isMDXComponent=!0}}]);